<link rel="import" href="../framework/polymer/polymer.html">
<link rel="import" href="../webcomponents/hiddencontainer.html">
<link rel="import" href="../webcomponents/json_combinator.html">

<dom-module id="selectable-json">

    <template>
        <input id="text" type="text" value="{{value::change}}" />
        <hidden-container>
            <json-combinator id="selector" value="{{value}}" name="[[name]]">
                <slot></slot>
            </json-combinator>
        </hidden-container>
    </template>

    <script>
    Polymer({
        is: 'selectable-json',
        properties: {
            name: {
                type: String,
                value: ""
            },
            value: {
                type: String,
                notify: true
            }
        },
        
        ready: function() {
            // Use host CSS style to set textbox style
            var objStyler = document.createElement("input");
            objStyler.type = "text";
            document.getElementsByTagName("body")[0].appendChild(objStyler);
            var targetStyle = window.getComputedStyle(objStyler);
            this.$['text'].style.cssText = targetStyle.cssText;
            this.$['text'].style.border = ""; // Seem to be weird problem when copying CSS
            objStyler.style.display = "none"; // hide that css-inspecting element
            
            // Propagate select event up to host element
            this.$['selector'].addEventListener('change', function(event) {
                this.dispatchEvent(new Event('change', {target: this, bubbles: true}));
            }.bind(this));
            // Propagate text change event up to host element
            this.$['text'].addEventListener("change", function(event) {
                this.dispatchEvent(new Event('change', {target: this, bubbles: true}));
            }.bind(this));
            
            // On value change, try to update radio selection
            this.addEventListener('change', function(event) {
                this.$['selector'].dispatchEvent(new Event('value-changed', {target: this.$['selector']}));
            }.bind(this));
            
            // Monitor value-change event, delegate it to "change" event
            this.addEventListener('value-changed', function(event) {
                this.dispatchEvent(new Event('change', {target: this, bubbles: true}));
            }.bind(this));
            
            // Initial values of json combinator
            this.dispatchEvent(new Event('change', {target: this, bubbles: true}));
            
        }, // end ready hook
    });
    </script>

</dom-module>
